import json

def __shadowenv() -> None:
  shadow_data = $(@SELF@ hook --json)
  if shadow_data:
      envs = json.loads(shadow_data)
      for k,v in envs.get("exported").items():
        if v is None:
            del ${k}
        else:
            ${k} = v

@events.on_post_rc
def __shadowenv_post_rc() -> None:
  __shadowenv()

@events.on_chdir
def __shadowenv_chdir(olddir: str, newdir: str) -> None:
  __shadowenv()
