(when-let ((ruby-root (env/get "RUBY_ROOT")))
  (env/remove-from-pathlist "PATH" (path-concat ruby-root "bin"))
  (when-let ((gem-root (env/get "GEM_ROOT")))
    (env/remove-from-pathlist "PATH" (path-concat gem-root "bin"))
    (env/remove-from-pathlist "GEM_PATH", gem-root))
  (when-let ((gem-home (env/get "GEM_HOME")))
    (env/remove-from-pathlist "PATH" (path-concat gem-home "bin"))
    (env/remove-from-pathlist "GEM_PATH", gem-home)))

(let* ((ruby-version "2.6.0")
       (ruby-root (path-concat "/opt/rubies" ruby-version)))
  (env/set "RUBY_ROOT" ruby-root)
  (env/set "RUBYOPT" nil)
  (env/prepend-to-pathlist "PATH" (path-concat ruby-root "bin")))

(env/set "RUBY_ENGINE" "ruby")
(env/set "RUBY_VERSION" "2.6.0")
(env/set "GEM_ROOT" "/opt/rubies/2.6.0/lib/ruby/gems/2.6.0")

(when-let ((gem-root (env/get "GEM_ROOT")))
  (env/prepend-to-pathlist "PATH" (path-concat gem-root "bin")))

(let ((gem-home (expand-path (path-concat "~/.gem" (env/get "RUBY_ENGINE") (env/get "RUBY_VERSION")))))
  (env/set "GEM_HOME" gem-home)
  (env/prepend-to-pathlist "PATH" (path-concat gem-home "bin"))
  (when-let ((gem-root (env/get "GEM_ROOT")))
    (env/prepend-to-pathlist "GEM_PATH" gem-root))
  (when-let ((gem-home (env/get "GEM_HOME")))
    (env/prepend-to-pathlist "GEM_PATH" gem-home)))
